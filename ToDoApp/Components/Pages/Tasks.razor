@page "/tasks"
@using ToDoApp.Data
@inject ToDoApp.Repositories.TaskRepository TaskRepo

<h3>To-Do-Liste</h3>

<button @onclick="AddSampleTask">Neue Aufgabe hinzufügen</button>

<ul>
    @foreach (var task in tasks)
    {
        <li>
            <b>@task.Title</b> - @task.Status
            <button @onclick="() => ToggleStatus(task)">Status wechseln</button>
            <button @onclick="() => DeleteTask(task.Id)">Löschen</button>
        </li>
    }
</ul>

@code {
    private List<TaskItem> tasks = new();

    protected override async Task OnInitializedAsync()
    {
        tasks = (await TaskRepo.GetTasksAsync()).ToList();
    }

    private async Task AddSampleTask()
    {
        var newTask = new TaskItem { Title = "Neue Aufgabe", Description = "", Status = "pending" };
        await TaskRepo.AddTaskAsync(newTask);
        tasks = (await TaskRepo.GetTasksAsync()).ToList();
    }

    private async Task ToggleStatus(TaskItem task)
    {
        task.Status = task.Status == "completed" ? "pending" : "completed";
        await TaskRepo.UpdateTaskAsync(task);
        tasks = (await TaskRepo.GetTasksAsync()).ToList();
    }

    private async Task DeleteTask(int id)
    {
        await TaskRepo.DeleteTaskAsync(id);
        tasks = (await TaskRepo.GetTasksAsync()).ToList();
    }
}
